<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>YouTube — For you (Fixed Version)</title>
<style>
:root{
--bg:#0f0f10;
--card:#141414;
--muted:#b3b3b3;
--accent:#ff0000;
--glass:rgba(255,255,255,0.03);
--gap:16px;
--max-width:1200px;
--sidebar-width:240px;
--radius:12px;
font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
color-scheme:dark;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
margin:0;
background:var(--bg);
color:#fff;
-webkit-font-smoothing:antialiased;
-moz-osx-font-smoothing:grayscale;
font-size:14px;
}
.app{display:grid;grid-template-rows:auto 1fr;min-height:100vh}
header{
position:sticky;top:0;z-index:40;
backdrop-filter:blur(6px);
background:linear-gradient(180deg,rgba(20,20,20,0.6),rgba(10,10,10,0.2));
border-bottom:1px solid rgba(255,255,255,0.03);
padding:10px 20px;
}
.header-inner{max-width:var(--max-width);margin:0 auto;display:flex;align-items:center;gap:12px}
.search{flex:1;display:flex;align-items:center;gap:8px;justify-content:center}
.search input{width:60%;max-width:520px;padding:8px 12px;border-radius:20px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted)}
.right-actions{display:flex;gap:10px;align-items:center}
.container{max-width:var(--max-width);margin:20px auto;display:grid;grid-template-columns:var(--sidebar-width) 1fr;gap:var(--gap);padding:0 20px}
aside.sidebar{height:calc(100vh - 120px);position:sticky;top:84px;padding:12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}
.nav{display:flex;flex-direction:column;gap:6px}
.nav a{padding:8px 10px;border-radius:10px;color:var(--muted);text-decoration:none}
.nav a.active{background:rgba(255,255,255,0.03);color:#fff;font-weight:600}
main{padding:6px}
.hero{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.hero .title{display:flex;flex-direction:column}
.hero h1{margin:0;font-size:20px}
.hero p{margin:2px 0 0;color:var(--muted);font-size:13px}
.filters{display:flex;gap:8px}
.chip{background:transparent!important;color:transparent!important;border-color:transparent!important;box-shadow:none!important;cursor:default!important}
.chip.selected{background:transparent;color:transparent;border-color:transparent;pointer-events:none}
.shorts{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;overflow:hidden;padding:8px 4px;margin-bottom:12px}
.short{min-width:160px;height:300px;border-radius:12px;background:linear-gradient(180deg,#222,#141414);display:flex;flex-direction:column;justify-content:flex-end;padding:10px;color:#fff;cursor:pointer}
.short img{width:100%;height:100%;object-fit:cover;border-radius:12px;position:absolute;left:0;top:0}
.short-inner{position:relative;width:100%;height:100%;border-radius:12px;overflow:hidden;display:flex;flex-direction:column;justify-content:flex-end;padding:10px;background:linear-gradient(180deg,rgba(0,0,0,0.0)0%,rgba(0,0,0,0.6)60%)}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.card{background:var(--card);border-radius:12px;padding:10px;border:1px solid rgba(255,255,255,0.02);cursor:pointer;overflow:hidden}
.thumb{height:160px;border-radius:8px;background:linear-gradient(135deg,#2a2a2a,#1a1a1a);position:relative;overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover;border-radius:6px;display:block}
.meta{display:flex;gap:10px;margin-top:10px}
.avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(180deg,#333,#111);flex-shrink:0}
.details{flex:1}
.details h3{margin:0 0 6px 0;font-size:15px}
.details p{margin:0;color:var(--muted);font-size:13px}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:none;grid-template-columns:2fr 1fr;gap:20px;padding:40px;z-index:1000;align-items:start}
.overlay.show{display:grid}
.player{background:#000;padding:10px;border-radius:8px}
.player iframe{width:100%;height:75vh;border:none;border-radius:6px}
.video-info{overflow-y:auto;background:#1a1a1a;padding:15px;border-radius:6px;max-height:80vh}
.video-info h3{margin:0 0 10px 0}
.video-info p{margin:6px 0;color:#bbb;font-size:14px}
.close-btn{position:absolute;top:18px;right:26px;font-size:36px;color:#fff;cursor:pointer;z-index:1001}
@media (max-width:1000px){.container{grid-template-columns:200px 1fr}.grid{grid-template-columns:repeat(2,1fr)}}
@media (max-width:720px){
.container{grid-template-columns:1fr;padding:0 12px}
aside.sidebar{display:none}
.grid{grid-template-columns:repeat(1,1fr)}
.search input{width:100%}
.overlay{padding:16px;grid-template-columns:1fr}
.player iframe{height:50vh}
}
</style>
</head>
<body>
<div class="app">
<header>
  <div class="header-inner">
    <div class="search"><input aria-label="Search" placeholder="Search" /></div>
    <div class="right-actions"></div>
  </div>
</header>

<div class="container">
  <aside class="sidebar" aria-label="Left navigation">
    <nav class="nav">
      <a href="#" data-action="home" class="active">Home</a>
      <a href="#" data-action="history">History</a>
    </nav>
  </aside>

  <main>
    <div class="hero">
      <div class="title">
        <h1>For you</h1>
        <p>Recommended videos picked just for you</p>
      </div>
    </div>

    <div class="shorts" aria-label="Shorts"></div>
    <section class="grid" aria-label="Recommended videos"></section>
    <p class="note" style="color:var(--muted);font-size:13px">Live “For You” feed powered by YouTube Data API.</p>
  </main>
</div>
</div>

<div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="close-btn" id="close-btn" title="Close">×</div>
  <div class="player" id="player"></div>
  <div class="video-info" id="video-info"></div>
</div>

<script>
const API_KEY = 'AIzaSyDN_G3ti9ZDKMCBqb_7JokZE3p50bcksos';
const MAX_RESULTS = 12;

let currentMode = 'fyp';
let nextPageToken = null;
let currentQuery = '';
let shownVideoIds = new Set();

const videoGrid = document.querySelector('.grid');
const searchInput = document.querySelector('.search input');
const overlay = document.getElementById('overlay');
const playerDiv = document.getElementById('player');
const infoDiv = document.getElementById('video-info');

/* ---- Overlay ---- */
function showOverlay(){overlay.classList.add('show');overlay.setAttribute('aria-hidden','false');document.body.style.overflow='hidden';}
function hideOverlay(){overlay.classList.remove('show');overlay.setAttribute('aria-hidden','true');playerDiv.innerHTML='';document.body.style.overflow='';}
document.getElementById('close-btn').addEventListener('click',hideOverlay);
overlay.addEventListener('click',e=>{if(e.target===overlay)hideOverlay();});

/* ---- Helpers ---- */
function escapeHtml(str=''){return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#39;");}
function formatViews(v){if(!v)return'0';const n=Number(v);if(n>=1e9)return(n/1e9).toFixed(1)+'B';if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1e3)return(n/1e3).toFixed(1)+'K';return String(n);}

/* ---- Fetch ---- */
async function fetchFYP(loadMore=false){
  if(!loadMore){nextPageToken=null;shownVideoIds.clear();videoGrid.innerHTML='';}
  let url=`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,contentDetails,status&chart=mostPopular&regionCode=US&maxResults=${MAX_RESULTS}&key=${API_KEY}`;
  if(loadMore&&nextPageToken)url+=`&pageToken=${nextPageToken}`;
  try{
    const res=await fetch(url);
    const data=await res.json();
    if(!data.items)throw new Error('No items');
    nextPageToken=data.nextPageToken||null;
    displayVideos(data.items);
  }catch(e){console.error(e);videoGrid.innerHTML='<p style="color:#b3b3b3">Failed to load videos.</p>';}
}

async function searchVideos(loadMore=false){
  const query=loadMore?currentQuery:(searchInput.value||'').trim();
  if(!query)return;
  if(!loadMore){shownVideoIds.clear();videoGrid.innerHTML='';nextPageToken=null;}
  try{
    let sUrl=`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=${MAX_RESULTS}&q=${encodeURIComponent(query)}&key=${API_KEY}`;
    if(loadMore&&nextPageToken)sUrl+=`&pageToken=${nextPageToken}`;
    const sRes=await fetch(sUrl);
    const sData=await sRes.json();
    nextPageToken=sData.nextPageToken||null;
    const ids=(sData.items||[]).map(i=>i.id.videoId).filter(Boolean).join(',');
    if(!ids)return;
    const vRes=await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,contentDetails,status&id=${ids}&key=${API_KEY}`);
    const vData=await vRes.json();
    displayVideos(vData.items||[]);
    currentMode='search';currentQuery=query;
    document.querySelector('.hero h1').innerText=`Results for "${query}"`;
  }catch(e){console.error('search error',e);}
}

/* ---- Display ---- */
function displayVideos(videos){
  videos.forEach(video=>{
    const id=video.id;
    if(!id||shownVideoIds.has(id))return;
    if(video.status&&!video.status.embeddable)return;
    shownVideoIds.add(id);
    const thumb=video.snippet.thumbnails?.high?.url||'';
    const card=document.createElement('article');
    card.className='card';
    card.innerHTML=`
      <div class="thumb"><img src="${thumb}" alt="${escapeHtml(video.snippet.title)}"></div>
      <div class="meta">
        <div class="avatar"></div>
        <div class="details">
          <h3>${escapeHtml(video.snippet.title)}</h3>
          <p>${escapeHtml(video.snippet.channelTitle)} • ${formatViews(video.statistics?.viewCount)} views</p>
        </div>
      </div>`;
    card.onclick=()=>playVideo(id,video.snippet,video.statistics);
    videoGrid.appendChild(card);
  });
}

/* ---- Player ---- */
function playVideo(id,snippet,stats){
  playerDiv.innerHTML=`<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&rel=0" allowfullscreen></iframe>`;
  infoDiv.innerHTML=`
    <h3>${escapeHtml(snippet.title)}</h3>
    <p>Channel: ${escapeHtml(snippet.channelTitle)}</p>
    <p>${formatViews(stats?.viewCount)} views • ${stats?.likeCount??'N/A'} likes</p>
    <p>${new Date(snippet.publishedAt).toLocaleDateString()}</p>
    <hr><p style="white-space:pre-wrap;color:#ddd">${escapeHtml(snippet.description)}</p>`;
  showOverlay();
}

/* ---- Scroll ---- */
window.addEventListener('scroll',()=>{
  if((window.innerHeight+window.scrollY)>=(document.body.offsetHeight-120)){
    if(currentMode==='fyp')fetchFYP(true);
    else if(currentMode==='search')searchVideos(true);
  }
});

/* ---- Search ---- */
searchInput.addEventListener('keydown',e=>{if(e.key==='Enter')searchVideos(false);});

/* ---- Sidebar ---- */
document.querySelectorAll('.nav a').forEach(a=>{
  a.addEventListener('click',e=>{
    e.preventDefault();
    document.querySelectorAll('.nav a').forEach(x=>x.classList.remove('active'));
    a.classList.add('active');
    if(a.dataset.action==='home'){fetchFYP();}
  });
});

/* ---- Start ---- */
fetchFYP();
</script>
</body>
</html>
